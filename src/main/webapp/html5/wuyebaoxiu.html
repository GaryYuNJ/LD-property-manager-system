<!DOCTYPE html>
<html class="hb-loaded"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="keywords" content="绿地会">
    <meta name="description" content="绿地会">
    <title>物业报修</title>
    <link rel="stylesheet" href="../style/call-fix.css">
    <style>
    </style>
</head>

<body style="max-width: 640px; margin: 0 auto;">
    <div id="mgshowMsg" class="mgshowMsg"></div>
    <div class="layer fixed"></div>
    <div class="container rel">
    
        <div class="content rel">
            <div hidden class="item rel">
                <div class="tag abs">报修单位</div>
                <div class="input rel">
                    <input id="organization" class="placeholder" placeholder="请输入报修单位" type="text">
                </div>
            </div>
            <div class="item rel">
                <div class="tag abs">报修人</div>
                <div class="input rel">
                    <input id="name" class="placeholder"  placeholder="请输入报修人姓名" type="text">
                </div>
            </div>
            <div class="item rel">
                <div class="tag abs">报修物品</div>
                <div class="input rel">
                    <input id="object"  class="placeholder"  placeholder="请输入报修物品" type="text">
                </div>
            </div>
            <div class="item rel">
                <div class="tag abs">联系电话</div>
                <div class="input rel">
                    <input id="mobile"  maxlength="11"  class="placeholder" placeholder="请输入联系电话" type="tel">
                </div>
            </div>
            <div class="item rel">
                <div class="tag abs">报修描述</div>
                <div class="input rel">
                    <input  id="callfix_desc" class="placeholder"  placeholder="请输入报修描述" type="text">
                </div>
            </div>
        </div>
        <div class="submit">
            <a href="javascript:;">提交申请</a>
        </div>
    </div>
    
    <div class="dialog fixed dialog-success">
        <div class="box rel">
            <p id="showMessage">您的报修已提交！</p>
            <div class="know rel">
                <a href="javascript:;">我知道了</a>
            </div>
        </div>
    </div>
    
	<script src="../js/jquery.js" ></script>
	<script src="../js/vue-1.0.26.min.js"></script>
	<script src="../js/date_format.js" ></script>
	<script src="../js/h5-common.js" ></script>

<script type="text/javascript">
    
    var communityCode = getQueryString('communityCode');
    var ssoTicket = getQueryString('ssoTicket');
    var userMobile = getQueryString('userMobile');
    if(null != userMobile && '' != userMobile){
    	$('#mobile').val(userMobile);
    }
    
    function showMsg(msg,type) {
        var tclass = type == 1? 'mgshowMsg-error': 'mgshowMsg-success',
                dom = $('#mgshowMsg')[0];
        dom.setAttribute('class', 'mgshowMsg '+ tclass +' mshow');
        dom.innerHTML = msg;
        setTimeout(function(){
            dom.setAttribute('class', 'mgshowMsg');
            dom.innerHTML = '';
        },2500);
    };
    $(function() {
        var date = new Date(),
            month = date.getMonth() + 1,
            month = month < 10 ? '0' + month : month,
            time = date.getHours() < 13 ? '上午' : '下午';
        $('.time').html(date.getFullYear() + '年' + month + '月' + date.getDate() + '日 ' + time);
    });

    $(document).off('touchend', '.submit');
    $(document).on('touchend', '.submit', function() {
        var $inputs = $('input'),
        	organization = $inputs.eq(0).val(),
        	name = $inputs.eq(1).val(),
        	object = $inputs.eq(2).val(),
        	mobile = $inputs.eq(3).val(),
        	callfix_desc = $inputs.eq(4).val();
        
        /*if (!organization|| /^\s+$/g.test(organization)) {
            showMsg('填写报修单位！',1);
            return false;
        } */
        if (!name|| /^\s+$/g.test(name)) {
            showMsg('填写报修人姓名！',1);
            return false;
        }
        if (!object|| /^\s+$/g.test(object)) {
            showMsg('填写报修物品！',1);
            return false;
        }
        if (!/^(13[0-9]{9}|15[012356789][0-9]{8}|18[0123456789][0-9]{8}|147[0-9]{8}|170[0-9]{8}|176[0-9]{8}|177[0-9]{8})$/.test(mobile)) {
            showMsg('请填写正确的11位报修联系人电话！',1);
            return false;
        }
        if (!callfix_desc|| /^\s+$/g.test(callfix_desc)) {
            showMsg('填写报修内容！',1);
            return false;
        }
        
        //submit 
        $.post( rootUri + '/open/addOwnerCallfix.shtml' + '?communityCode='+communityCode+'&ssoTicket='+ssoTicket,
			{
        	organization:organization,
        	name:name,
        	object:object,
        	mobile:mobile,
        	callfixDesc:callfix_desc
			},
			function(result){
				console.log(result);
				if(result.status == '200'){
			        $inputs.val('');
			        $('#showMessage').html("您的报修已成功提交！");
			        $('.layer, .dialog').show();
					
				}else{
					$('#showMessage').html("系统错误，暂时无法提交！");
			        $('.layer, .dialog').show();
				}
			},'json');
    });

    $(document).off('touchend', '.layer, .dialog');
    $(document).on('touchend', '.layer, .dialog', function() {
        $('.layer, .dialog').hide();
    });
</script>


</body></html>